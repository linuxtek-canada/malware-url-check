#!/usr/bin/python3

#Author:    Jason Paul 
#Email:     jasonpa@gmail.com

import os
import boto3
import json
import validators
from boto3.dynamodb.conditions import Key

# Lambda Handler - cannot modify this method
def lambda_handler(event, context):

  # Logging for CloudWatch
  print(event)
  
  dynamodb = boto3.resource('dynamodb')
  client = boto3.client('dynamodb')
  table = dynamodb.Table('MalwareBlacklist')
  MalwareURL = event['queryStringParameters']['MalwareURL']

  # Putting a try/catch to log to the user when an error occurs posting the URL,
  try:

    # Validate if this is a valid URL.  Raise exception if it is not,
    valid=validators.url(MalwareURL)
    if valid==True:
      table.put_item(
        Item={
          'BlacklistURL': MalwareURL
          }
        )
      return {
        'statusCode': 200,
        'body': json.dumps('New Malware URL Added to Blacklist Successfully!')
      }
    else:
      raise
  
  except:
    return {
      'statusCode': 400,
      'body': json.dumps('Error adding new Malware URL to Blacklist.')
    }
